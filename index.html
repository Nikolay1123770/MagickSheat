<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Magic Store</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0e0017;--fg:#fff;--glow:#ff00ff;--glow2:#7a00ff;
      --ok1:#059669;--ok2:#10b981;--warn1:#b45309;--warn2:#f59e0b;--info1:#3b82f6;--muted:#ffffff33;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Orbitron',sans-serif;background:var(--bg);color:var(--fg)}
    a{color:#ffd6ff}
    .topbar{position:sticky;top:0;z-index:20;display:flex;gap:8px;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(0,0,0,.6);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid #ffffff22}
    .brand{letter-spacing:1px}
    .btn{cursor:pointer; padding:10px 16px;border-radius:18px;border:1px solid transparent;background:linear-gradient(90deg,var(--glow2),var(--glow));color:#fff}
    .btn.ghost{background:transparent;border-color:var(--glow)}
    .btn.ok{background:linear-gradient(90deg,var(--ok1),var(--ok2))}
    .btn.warn{background:linear-gradient(90deg,var(--warn1),var(--warn2))}
    .btn.info{background:linear-gradient(90deg,var(--info1),#60a5fa)}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
    .card{background:rgba(0,0,0,.55);padding:16px;border-radius:16px;border:1px solid rgba(255,0,255,.3);box-shadow:0 0 14px rgba(255,0,255,.18)}
    .category-title{font-size:18px;margin:18px 0 8px;color:#ffd6ff;text-shadow:0 0 8px var(--glow)}
    .price{opacity:.9;margin-top:6px}
    .muted{color:#ffffffaa}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .input, textarea, select{width:100%;padding:10px;border-radius:12px;border:1px solid #ffffff33;background:rgba(0,0,0,.4);color:#fff}
    .status{display:inline-block;padding:6px 10px;border-radius:10px;border:1px solid #ffffff33}
    .status.pending{background:#f59e0b33;border-color:#f59e0b66}
    .status.confirmed{background:#60a5fa33;border-color:#60a5fa66}
    .status.delivered{background:#10b98133;border-color:#10b98166}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #ffffff22;text-align:left}
    .pill{padding:4px 10px;border:1px solid #ffffff22;border-radius:999px}
    .stars{font-size:18px;letter-spacing:2px}
    .hidden{display:none}
    footer{opacity:.8;padding:40px 0}
    /* Mobile tweaks */
    @media (max-width:768px){.wrap{padding:12px}.grid{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}.topbar{flex-wrap:wrap;gap:6px}}
  
    /* --- MAGIC THEME ADDITIONS --- */
    body {
      margin: 0;
      color: #fff;
      background: linear-gradient(270deg, #1e3c72, #2a5298, #28a745);
      background-size: 600% 600%;
      animation: gradientShift 20s ease infinite;
      overflow-x: hidden;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Particles overlay */
    .particles {
      position: fixed; top:0; left:0; width:100%; height:100%;
      overflow:hidden; z-index: 1; pointer-events: none;
    }
    .particle { position:absolute; background: rgba(255,255,255,0.7); border-radius:50%; animation: floatUp linear infinite; }
    @keyframes floatUp {
      from { transform: translateY(100vh) scale(0.5); opacity: 0; }
      25% { opacity: 1; }
      to { transform: translateY(-10vh) scale(1); opacity: 0; }
    }
    /* Make main content above particles */
    .wrap, header.topbar, footer { position: relative; z-index: 2; }
    /* Style tweak for nav button to match magic vibe */
    .btn.ghost.magic { border-color:#00ff87; color:#fff; }
    /* Banner card look similar to product */
    .magic-banner { background: rgba(0,0,0,0.35); padding: 16px; border-radius: 16px; border:1px solid rgba(0,255,135,.35); box-shadow:0 0 12px rgba(0,0,0,0.4); }

  
    /* --- MAGIC STYLE OVERRIDES FOR TOPBAR & CATALOG --- */
    header.topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
      background: rgba(0,0,0,0.35);
      position: sticky;
      top: 0;
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(0,255,135,0.3);
      box-shadow: 0 0 12px rgba(0,255,135,0.25);
    }
    header.topbar .brand {
      font-size: 24px;
      font-weight: bold;
      letter-spacing: 1px;
      color: #fff;
      text-shadow: 0 0 8px #00ff87;
    }
    .btn, .btn.ghost {
      cursor: pointer;
      padding: 10px 18px;
      border-radius: 25px;
      border: none;
      background: linear-gradient(90deg, #00c6ff, #00ff87);
      color: #fff;
      font-weight: 700;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
    }
    .btn:hover, .btn.ghost:hover {
      transform: scale(1.08);
      box-shadow: 0 0 18px rgba(0,255,135,0.7);
    }
    .card {
      background: rgba(0,0,0,0.35);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 0 20px rgba(0,255,135,0.5);
    }
    .category-title {
      font-size: 22px;
      margin: 20px 0 10px;
      color: #00ff87;
      text-shadow: 0 0 6px rgba(0,255,135,0.7);
    }

  
    /* Fade-in animation for catalog cards */
    .card {
      opacity: 0;
      animation: fadeInUp 0.8s ease forwards;
    }
    @keyframes fadeInUp {
      from {opacity:0; transform: translateY(20px);}
      to {opacity:1; transform: translateY(0);}
    }

  </style>
</head>
<body>
  <div class="particles"></div>
  <header class="topbar">
    <div class="brand">Magik<span style="color:#00ff87">VipSheat</span></div>
    <nav class="row">
      <button class="btn ghost" data-link="#/catalog">–ö–∞—Ç–∞–ª–æ–≥</button>
      <button class="btn ghost" data-link="#/cart">–ö–æ—Ä–∑–∏–Ω–∞</button>
      <button class="btn ghost" data-link="#/orders">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</button>
      <button class="btn ghost" data-link="#/profile">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
      <button class="btn ghost" data-link="#/admin">–ê–¥–º–∏–Ω</button>
      <button class="btn ghost" data-link="#/info">–ò–Ω—Ñ–æ</button>
    </nav>
    <a href="https://t.me/GaksaCheats" target="_blank" class="btn ghost magic">–ù–∞—à —Ç–µ–ª–µ–≥—Ä–∞–º–º –∫–∞–Ω–∞–ª</a>
  </header>

  <main class="wrap">
    <!-- CATALOG -->
    <section id="page-catalog" class="page">
      <h2>–ö–∞—Ç–∞–ª–æ–≥</h2>
      <div class="row" style="margin:6px 0 14px">
        <input id="search" class="input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É..."/>
      </div>
      <div class="category-title">Android</div>
      <div id="androidGrid" class="grid"></div>
      

      
      <div class="magic-banner" style="max-width:860px;margin:20px auto;text-align:center">
        <img src="42200bf1-3768-413a-ac90-a5060e0357ef.png" alt="Gaksa" style="width:100%;height:auto;display:block;border-radius:12px;margin-bottom:15px">
        <h2 style="margin:6px 0 8px;color:#00ff87;text-shadow:0 0 8px #00ff87;">Gaksa</h2>
        <p style="margin:4px 0;font-weight:bold;">–û–§–ò–¶–ò–ê–õ–¨–ù–´–ô –ü–†–û–î–ê–í–ï–¶ / –í–õ–ê–î–ï–õ–ï–¶ –°–ê–ô–¢–ê</p>
        <p style="margin:4px 0;">Gaksa01YT | channel GaksaCheats</p>
      </div>


    </section>

    <!-- PRODUCT (modal-like inline) -->
    <section id="page-product" class="page hidden">
      <button class="btn ghost" data-link="#/catalog">‚Üê –ù–∞–∑–∞–¥</button>
      <div id="productView" class="card"></div>
      <div class="card" style="margin-top:12px">
        <h3>–û—Ç–∑—ã–≤—ã</h3>
        <div id="reviewsList"></div>
        <div style="margin-top:12px">
          <textarea id="revText" class="input" placeholder="–í–∞—à –æ—Ç–∑—ã–≤..."></textarea>
          <div class="row" style="margin-top:8px">
            <label>–û—Ü–µ–Ω–∫–∞:
              <select id="revRate" class="input" style="max-width:140px">
                <option value="5">5</option><option value="4">4</option><option value="3">3</option>
                <option value="2">2</option><option value="1">1</option>
              </select>
            </label>
            <button class="btn" id="btnAddReview">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
          </div>
        </div>
      </div>
    </section>

    <!-- CHECKOUT (after selecting from cart or buy) -->
    <section id="page-checkout" class="page hidden">
      <button class="btn ghost" data-link="#/catalog">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="card">
        <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
        <div id="checkoutSummary" class="muted"></div>
        <h3>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h3>
        <label><input type="radio" name="paymethod" value="–°–±–µ—Ä" checked> üí≥ –°–±–µ—Ä–∫–∞—Ä—Ç–∞: 2202 2081 9616 3183 (–ê—Ä—Ç–µ–º –ö)</label><br>
        <label><input type="radio" name="paymethod" value="–°–ë–ü"> üì≤ –°–ë–ü: 8 950 773 94 12</label><br>
        <textarea id="customerNote" class="input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ–ø–ª–∞—Ç–µ (–≤—Ä–µ–º—è, —Å—É–º–º–∞, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã)..."></textarea>
        <div class="row"><button class="btn" id="btnPayDone">–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)</button></div>
      </div>
    </section>

    <!-- WAITING / STATUS -->
    <section id="page-wait" class="page hidden">
      <div class="card">
        <h2>–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h2>
        <div id="waitInfo"></div>
        <div id="waitStatus" class="status pending">pending</div>
      </div>
    </section>

    <!-- DELIVERED -->
    <section id="page-delivery" class="page hidden">
      <div class="card">
        <h2>–î–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω</h2>
        <div id="deliverKey"></div>
        <div id="deliverFiles" class="row" style="margin-top:10px;flex-wrap:wrap"></div>
        <button class="btn info" data-link="#/orders">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–∫–∞–∑–∞–º</button>
      </div>
    </section>

    <!-- CART -->
    <section id="page-cart" class="page hidden">
      <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
      <div id="cartList"></div>
      <div class="row" style="margin-top:10px"><button class="btn" id="btnGoCheckout">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button></div>
    </section>

    <!-- ORDERS -->
    <section id="page-orders" class="page hidden">
      <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
      <div class="card">
        <table>
          <thead><tr><th>ID</th><th>–¢–æ–≤–∞—Ä</th><th>–¶–µ–Ω–∞</th><th>–û–ø–ª–∞—Ç–∞</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
          <tbody id="ordersTable"></tbody>
        </table>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="page-profile" class="page hidden">
      <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
      <div class="card">
        <div id="profileBox"></div>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="page-admin" class="page hidden">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
          <div id="adminAuth"></div>
        </div>
      </div>
      <div id="adminArea" class="hidden">
        <div class="card">
          <h3>–ó–∞–∫–∞–∑—ã</h3>
          <table>
            <thead><tr><th>ID</th><th>–¢–æ–≤–∞—Ä</th><th>–¶–µ–Ω–∞</th><th>–û–ø–ª–∞—Ç–∞</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
            <tbody id="adminOrders"></tbody>
          </table>
        </div>
        <div class="card">
          <h3>–í—ã–¥–∞—Ç—å —Ñ–∞–π–ª—ã (–¥–æ 20 —à—Ç –Ω–∞ –∑–∞–∫–∞–∑)</h3>
          <div class="row">
            <input id="fileOrderId" class="input" placeholder="ID –∑–∞–∫–∞–∑–∞" style="max-width:220px">
            <input id="fileInput" type="file" multiple class="input"/>
            <button class="btn ok" id="btnAttachFiles">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫ –∑–∞–∫–∞–∑—É</button>
          </div>
        </div>
      </div>
    </section>
  
    <!-- INFO (as separate SPA page) -->
    <section id="page-info" class="page hidden">
      <div class="magic-banner" style="max-width:880px;margin:10px auto;text-align:left">
        <h2>–ü—Ä–µ–º–∏—É–º —á–∏—Ç –¥–ª—è Oxide Survival Island: No ROOT, No Ban!</h2>
        <p>–ò—â–µ—Ç–µ —Å–ø–æ—Å–æ–± –ø–æ–≤—ã—Å–∏—Ç—å —Å–≤–æ–∏ —à–∞–Ω—Å—ã –Ω–∞ –≤—ã–∂–∏–≤–∞–Ω–∏–µ –≤ Oxide Survival Island? –ù–∞—à —á–∏—Ç ‚Äî —ç—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ! –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏—Ç –≤–∞–º –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –≤ –∏–≥—Ä–µ, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –≤–∞—à—É —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</p>
        <h3>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª</h3>
        <ul>
          <li><strong>ESP</strong>: –í–∏–¥–∏—Ç–µ –∏–≥—Ä–æ–∫–æ–≤, —Ä–µ—Å—É—Ä—Å—ã –∏ –æ–±—ä–µ–∫—Ç—ã —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã.</li>
          <li><strong>Aim</strong>: –ê–≤—Ç–æ–ø—Ä–∏—Ü–µ–ª –¥–ª—è —Ç–æ—á–Ω—ã—Ö –ø–æ–ø–∞–¥–∞–Ω–∏–π.</li>
          <li><strong>Magic Bullet</strong>: –ü—É–ª–∏ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥—è—Ç —Ü–µ–ª—å.</li>
          <li><strong>AutoFarm</strong>: –ê–≤—Ç–æ—Å–±–æ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤.</li>
          <li><strong>Night Vision</strong>: –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –≤ —Ç–µ–º–Ω–æ—Ç–µ.</li>
        </ul>
        <h3>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h3>
        <ul>
          <li><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</strong>: –ë–µ–∑ —Ä—É—Ç-–ø—Ä–∞–≤ –∏ –±–µ–∑ –±–∞–Ω–æ–≤.</li>
          <li><strong>–ü—Ä–æ—Å—Ç–æ—Ç–∞</strong>: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞ –º–∏–Ω—É—Ç—ã.</li>
          <li><strong>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è</strong>: –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∞–ø–¥–µ–π—Ç—ã –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.</li>
        </ul>
        <p>–ü–æ–ª—É—á–∏—Ç–µ –Ω–∞—à —á–∏—Ç —É–∂–µ —Å–µ–≥–æ–¥–Ω—è –∏ –Ω–∞—á–Ω–∏—Ç–µ –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ Oxide Survival Island!</p>
      </div>
    </section>

  </main>

  <footer class="wrap">
    <div class="muted">¬© MagikVipSheat. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</div>
  </footer>

<script>
/*************************
 * Minimal SPA Router
 *************************/
const pages = {
  '#/info':'page-info',
  '#/catalog':'page-catalog', '#/cart':'page-cart', '#/checkout':'page-checkout',
  '#/wait':'page-wait', '#/delivered':'page-delivery', '#/orders':'page-orders',
  '#/profile':'page-profile', '#/admin':'page-admin', '#/product':'page-product'
};
function show(hash){
  // default
  if(!hash || !(hash in pages)) hash = '#/catalog';
  document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
  document.getElementById(pages[hash]).classList.remove('hidden');
  // per-page hooks
  if(hash==="#/catalog") renderCatalog();
  if(hash==="#/cart") renderCart();
  if(hash==="#/orders") renderOrdersTable();
  if(hash==="#/profile") renderProfile();
  if(hash==="#/admin") renderAdmin();
}
window.addEventListener('hashchange',()=>{
  const h = location.hash.split('?')[0];
  // product deep-link: #/product:id
  if(h.startsWith('#/product')){
    const pid = h.split(':')[1];
    openProduct(pid);
  } else {
    show(h);
  }
});
document.querySelectorAll('[data-link]').forEach(b=>b.addEventListener('click', e=>{location.hash=e.currentTarget.dataset.link;}));

/*************************
 * Demo data & helpers
 *************************/
const PRODUCTS=[
  {id:'vip1', os:'android', name:'VipVersion 1 day', price:225, desc:'Vip –¥–æ—Å—Ç—É–ø –Ω–∞ 1 –¥–µ–Ω—å.'},
  {id:'vip7', os:'android', name:'VipVersion 7 day', price:700, desc:'Vip –¥–æ—Å—Ç—É–ø –Ω–∞ 7 –¥–Ω–µ–π.'},
  {id:'vip14', os:'android', name:'VipVersion 14 day', price:1350, desc:'Vip –¥–æ—Å—Ç—É–ø –Ω–∞ 14 –¥–Ω–µ–π.'}
];
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

/*************************
 * IndexedDB tiny layer
 *************************/
const DB={db:null};
function dbOpen(){
  return new Promise((res,rej)=>{
    const req=indexedDB.open('hyperDB',3);
    req.onupgradeneeded=e=>{
      const db=e.target.result;
      if(!db.objectStoreNames.contains('orders')) db.createObjectStore('orders',{keyPath:'id'});
      if(!db.objectStoreNames.contains('files')) db.createObjectStore('files',{keyPath:'fid'});
      if(!db.objectStoreNames.contains('reviews')) db.createObjectStore('reviews',{keyPath:'rid'});
      if(!db.objectStoreNames.contains('meta')) db.createObjectStore('meta',{keyPath:'key'});
    };
    req.onsuccess=()=>{DB.db=req.result;res()};
    req.onerror=()=>rej(req.error);
  });
}
function tx(store,mode='readonly'){return DB.db.transaction(store,mode).objectStore(store)}
// ORDERS
async function ordersGetAll(){return new Promise((res)=>{const r=tx('orders').getAll();r.onsuccess=()=>res(r.result||[])})}
async function ordersPut(o){return new Promise((res)=>{const r=tx('orders','readwrite').put(o);r.onsuccess=()=>res(true)})}
async function ordersGet(id){return new Promise((res)=>{const r=tx('orders').get(id);r.onsuccess=()=>res(r.result)})}
// FILES
async function filePut(fid, obj){return new Promise((res)=>{const r=tx('files','readwrite').put({fid,...obj});r.onsuccess=()=>res(true)})}
async function fileGet(fid){return new Promise((res)=>{const r=tx('files').get(fid);r.onsuccess=()=>res(r.result)})}
// REVIEWS
async function reviewAdd(rec){return new Promise((res)=>{const r=tx('reviews','readwrite').put(rec);r.onsuccess=()=>res(true)})}
async function reviewsByProduct(pid){return new Promise((res)=>{
  const out=[];const cursorReq=tx('reviews').openCursor();
  cursorReq.onsuccess=e=>{const c=e.target.result;if(c){if(c.value.pid===pid) out.push(c.value); c.continue()} else res(out)}
})}

/*************************
 * Auth (very light demo)
 *************************/
function currentUser(){try{return JSON.parse(localStorage.getItem('user'))}catch{return null}}
function requireUser(){const u=currentUser(); if(!u){alert('–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç'); location.hash='#/profile';} return !!u}

/*************************
 * Catalog, Search, Cart
 *************************/
let CART = JSON.parse(localStorage.getItem('cart')||'[]');
function saveCart(){localStorage.setItem('cart',JSON.stringify(CART))}
function renderCatalog(){
  const q = ($('#search')?.value||'').toLowerCase();
  const listA=PRODUCTS.filter(p=>p.os==='android' && (!q || p.name.toLowerCase().includes(q)));
  const listI=PRODUCTS.filter(p=>p.os==='ios' && (!q || p.name.toLowerCase().includes(q)));
  $('#androidGrid').innerHTML=listA.map(cardHTML).join('');
  $('#iosGrid').innerHTML=listI.map(cardHTML).join('');
}
function cardHTML(p){
  return `<div class="card"><h3>${p.name}</h3><div class="price">${p.price}‚ÇΩ</div>
    <div class="row"><button class="btn" onclick="addToCart('${p.id}')">–í –∫–æ—Ä–∑–∏–Ω—É</button>
    <button class="btn ghost" onclick="location.hash='#/product:${p.id}'">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button></div></div>`
}
function addToCart(id){
  const p=PRODUCTS.find(x=>x.id===id);
  if(!CART.find(x=>x.id===id)){CART.push({id:p.id,name:p.name,price:p.price}); saveCart(); alert('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É');}
  else alert('–£–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ');
}
$('#search')?.addEventListener('input',renderCatalog);

function renderCart(){
  const root=$('#cartList');
  if(!CART.length){root.innerHTML='<div class="card">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';return}
  const sum = CART.reduce((a,b)=>a+b.price,0);
  root.innerHTML = CART.map(i=>`<div class="card row" style="justify-content:space-between"><div><b>${i.name}</b><div class='muted'>${i.price}‚ÇΩ</div></div><button class="btn warn" onclick="removeCart('${i.id}')">–£–¥–∞–ª–∏—Ç—å</button></div>`).join('')+
    `<div class="card row" style="justify-content:space-between"><div><b>–ò—Ç–æ–≥–æ:</b></div><div>${sum}‚ÇΩ</div></div>`;
}
function removeCart(id){CART=CART.filter(i=>i.id!==id); saveCart(); renderCart()}
$('#btnGoCheckout')?.addEventListener('click',()=>{ if(!CART.length) return alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); startCheckoutFromCart(); });

/*************************
 * Product view + Reviews
 *************************/
let CURRENT_PRODUCT=null;
async function openProduct(pid){
  CURRENT_PRODUCT = PRODUCTS.find(p=>p.id===pid);
  if(!CURRENT_PRODUCT){alert('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω'); location.hash='#/catalog'; return}
  $('#productView').innerHTML = `<h2>${CURRENT_PRODUCT.name}</h2><div class='muted'>${CURRENT_PRODUCT.desc}</div>
    <div class='price'>–¶–µ–Ω–∞: <b>${CURRENT_PRODUCT.price}‚ÇΩ</b></div>
    <div class='row' style='margin-top:10px'><button class='btn' onclick="addToCart('${CURRENT_PRODUCT.id}')">–í –∫–æ—Ä–∑–∏–Ω—É</button>
    <button class='btn ghost' onclick="buyNow('${CURRENT_PRODUCT.id}')">–ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å</button></div>`;
  location.hash = '#/product:'+pid; // ensure route
  renderReviewsUI(pid);
  show('#/product');
}
$('#btnAddReview')?.addEventListener('click', async ()=>{
  const text=$('#revText').value.trim(); const rate=parseInt($('#revRate').value||'5');
  if(!text) return alert('–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤');
  const rid=Math.random().toString(36).slice(2,10);
  await reviewAdd({rid, pid:CURRENT_PRODUCT.id, text, rate, author:(currentUser()?.username||'–ì–æ—Å—Ç—å'), ts:Date.now()});
  $('#revText').value=''; renderReviewsUI(CURRENT_PRODUCT.id); alert('–û—Ç–∑—ã–≤ –¥–æ–±–∞–≤–ª–µ–Ω');
});
async function renderReviewsUI(pid){
  const list = await reviewsByProduct(pid);
  if(!list.length){$('#reviewsList').innerHTML='<div class="muted">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</div>'; return}
  const avg = (list.reduce((a,b)=>a+b.rate,0)/list.length).toFixed(1);
  $('#reviewsList').innerHTML = `<div class='row'><div class='pill'>–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: ${avg} ‚òÖ</div><div class='pill'>–û—Ç–∑—ã–≤–æ–≤: ${list.length}</div></div>` +
    list.sort((a,b)=>b.ts-a.ts).map(r=>`<div class='card'><div class='row' style='justify-content:space-between'><b>${r.author}</b><span class='stars'>${'‚òÖ'.repeat(r.rate)}${'‚òÜ'.repeat(5-r.rate)}</span></div><div class='muted' style='margin-top:6px'>${r.text}</div></div>`).join('');
}
function buyNow(id){
  const p=PRODUCTS.find(x=>x.id===id); CART=[{id:p.id,name:p.name,price:p.price}]; saveCart(); startCheckoutFromCart();
}

/*************************
 * Checkout & Orders (IndexedDB persisted)
 *************************/
let ACTIVE_ORDER_ID=null;
function startCheckoutFromCart(){
  const sum=CART.reduce((a,b)=>a+b.price,0);
  $('#checkoutSummary').innerText = CART.map(i=>`${i.name} ‚Äî ${i.price}‚ÇΩ`).join(' \n ') + `\n–ò—Ç–æ–≥–æ: ${sum}‚ÇΩ`;
  location.hash='#/checkout'; show('#/checkout');
}
$('#btnPayDone')?.addEventListener('click', async ()=>{
  if(!CART.length) return alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
  const method= document.querySelector('input[name=paymethod]:checked').value;
  const note = $('#customerNote').value.trim();
  const id = Math.random().toString(36).slice(2,8);
  const order={id, items:[...CART], price:CART.reduce((a,b)=>a+b.price,0), method, note, status:'pending', files:[], createdAt:Date.now()};
  await ordersPut(order); CART=[]; saveCart(); ACTIVE_ORDER_ID=id; await renderWait(order.id);
  location.hash='#/wait';
});

async function renderWait(id){
  const o = await ordersGet(id||ACTIVE_ORDER_ID); if(!o) return;
  $('#waitInfo').innerText = `–ó–∞–∫–∞–∑ ${o.id}: ${o.items.map(i=>i.name).join(', ')} ‚Äî ${o.price}‚ÇΩ (–æ–ø–ª–∞—Ç–∞: ${o.method})`;
  $('#waitStatus').className = 'status ' + o.status; $('#waitStatus').innerText = o.status;
}

async function renderOrdersTable(){
  const list = (await ordersGetAll()).sort((a,b)=>b.createdAt-a.createdAt);
  const tbody = $('#ordersTable');
  if(!list.length){tbody.innerHTML = `<tr><td colspan='6'>–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</td></tr>`; return}
  tbody.innerHTML = list.map(o=>`<tr><td>${o.id}</td><td>${o.items.map(i=>i.name).join(', ')}</td><td>${o.price}‚ÇΩ</td><td>${o.method}</td><td><span class='status ${o.status}'>${o.status}</span></td><td>${o.status!=='delivered'?`<button class='btn ghost' onclick=\"goWait('${o.id}')\">–°—Ç–∞—Ç—É—Å</button>`:`<button class='btn ok' onclick=\"openDelivery('${o.id}')\">–ü–æ–ª—É—á–∏—Ç—å</button>`}</td></tr>`).join('');
}
window.goWait = async (id)=>{ACTIVE_ORDER_ID=id; await renderWait(id); location.hash='#/wait'}
window.openDelivery = async (id)=>{const o=await ordersGet(id); await showDelivery(o)}

async function showDelivery(order){
  if(!order) return; $('#deliverKey').innerText = 'KEY-' + order.id.toUpperCase();
  const box=$('#deliverFiles'); box.innerHTML='';
  if(order.files?.length){
    for(const fid of order.files){ const f = await fileGet(fid); if(!f) continue; const blob=new Blob([f.data],{type:f.type}); const a=document.createElement('a'); a.download=f.name; a.href=URL.createObjectURL(blob); a.className='btn ok'; a.textContent='üìÇ '+f.name; box.appendChild(a); }
  } else {
    const blob=new Blob([`–í–∞—à –∫–ª—é—á: KEY-${order.id.toUpperCase()}`],{type:'text/plain'});
    const a=document.createElement('a'); a.download='key.txt'; a.href=URL.createObjectURL(blob); a.className='btn ok'; a.textContent='–°–∫–∞—á–∞—Ç—å –∫–ª—é—á'; box.appendChild(a);
  }
  location.hash='#/delivered'; show('#/delivered');
}

/*************************
 * Profile (register/login demo)
 *************************/
function renderProfile(){
  const u=currentUser();
  if(u){
    $('#profileBox').innerHTML = `<div class='row' style='justify-content:space-between'><div><b>${u.username}</b><div class='muted'>${u.email}</div></div><button class='btn warn' onclick='logout()'>–í—ã–π—Ç–∏</button></div>
    <div class='row' style='margin-top:10px'><button class='btn' data-link='#/orders' onclick='location.hash="#/orders"'>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</button></div>`;
  } else {
    $('#profileBox').innerHTML = `<div class='row' style='gap:6px;flex-direction:column;align-items:stretch'>
      <input id='regName' class='input' placeholder='–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'>
      <input id='regEmail' class='input' placeholder='Email'>
      <input id='regPass' type='password' class='input' placeholder='–ü–∞—Ä–æ–ª—å'>
      <button class='btn' onclick='register()'>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      <div class='muted'>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–≤–µ–¥–∏—Ç–µ Email –∏ –ü–∞—Ä–æ–ª—å –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–í–æ–π—Ç–∏¬ª.</div>
      <button class='btn ghost' onclick='login()'>–í–æ–π—Ç–∏</button>
    </div>`;
  }
}
function register(){
  const username=$('#regName').value.trim(); const email=$('#regEmail').value.trim(); const password=$('#regPass').value;
  if(!username||!email||!password) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è');
  localStorage.setItem('user',JSON.stringify({username,email,password})); alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞'); renderProfile();
}
function login(){
  const email=$('#regEmail').value.trim(); const pass=$('#regPass').value; const u=currentUser();
  if(u && u.email===email && u.password===pass){ alert('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω'); renderProfile()} else alert('–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
}
function logout(){ localStorage.removeItem('user'); renderProfile(); }

/*************************
 * Admin (login + manage orders + attach files)
 *************************/
const ADMIN={logged:false,user:'Magic',pass:'Lop123lop'};
function renderAdmin(){
  $('#adminAuth').innerHTML = ADMIN.logged ? `<span class='pill'>–í—Ö–æ–¥: admin</span> <button class='btn warn' onclick='adminLogout()'>–í—ã–π—Ç–∏</button>` : `
    <input id='admUser' class='input' placeholder='–õ–æ–≥–∏–Ω' style='max-width:140px'>
    <input id='admPass' type='password' class='input' placeholder='–ü–∞—Ä–æ–ª—å' style='max-width:160px'>
    <button class='btn' onclick='adminLogin()'>–í–æ–π—Ç–∏</button>`;
  $('#adminArea').classList.toggle('hidden',!ADMIN.logged);
  if(ADMIN.logged) fillAdminOrders();
}
function adminLogin(){ ADMIN.logged = ($('#admUser').value===ADMIN.user && $('#admPass').value===ADMIN.pass); if(!ADMIN.logged) alert('–ù–µ–≤–µ—Ä–Ω–æ'); renderAdmin(); }
function adminLogout(){ ADMIN.logged=false; renderAdmin(); }
async function fillAdminOrders(){
  const list= (await ordersGetAll()).sort((a,b)=>b.createdAt-a.createdAt);
  $('#adminOrders').innerHTML = list.map(o=>`<tr><td>${o.id}</td><td>${o.items.map(i=>i.name).join(', ')}</td><td>${o.price}‚ÇΩ</td><td>${o.method}</td><td>${o.note||''}</td><td><span class='status ${o.status}'>${o.status}</span></td><td>
    ${o.status==='pending'?`<button class='btn ghost' onclick=\"admConfirm('${o.id}')\">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>`:''}
    <button class='btn ok' onclick=\"admDeliver('${o.id}')\">–í—ã–¥–∞—Ç—å</button></td></tr>`).join('');
}
async function admConfirm(id){ const o=await ordersGet(id); if(!o) return; o.status='confirmed'; await ordersPut(o); await fillAdminOrders(); if(ACTIVE_ORDER_ID===id) await renderWait(id) }
async function admDeliver(id){ const o=await ordersGet(id); if(!o) return; o.status='delivered'; await ordersPut(o); await fillAdminOrders(); if(ACTIVE_ORDER_ID===id) await showDelivery(o) }

// Attach files to order (persisted in IndexedDB as ArrayBuffer)
$('#btnAttachFiles')?.addEventListener('click', async ()=>{
  const id = $('#fileOrderId').value.trim(); if(!id) return alert('–£–∫–∞–∂–∏—Ç–µ ID –∑–∞–∫–∞–∑–∞');
  const o = await ordersGet(id); if(!o) return alert('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
  const files = $('#fileInput').files; if(!files.length) return alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã');
  if(!o.files) o.files=[];
  const limit=20; if(o.files.length + files.length > limit) return alert('–õ–∏–º–∏—Ç 20 —Ñ–∞–π–ª–æ–≤ –Ω–∞ –∑–∞–∫–∞–∑');
  for(const f of files){
    const buf = await f.arrayBuffer(); const fid = id+'_'+Math.random().toString(36).slice(2,8);
    await filePut(fid,{name:f.name,type:f.type,data:buf,orderId:id,ts:Date.now()});
    o.files.push(fid);
  }
  await ordersPut(o); $('#fileInput').value=''; alert('–§–∞–π–ª—ã –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω—ã'); await fillAdminOrders();
});

/*************************
 * Boot
 *************************/
(async function(){
  await dbOpen();
  // open route
  const h = location.hash.split('?')[0];
  if(h.startsWith('#/product:')){ openProduct(h.split(':')[1]); }
  else show(h);
})();
</script>

<script>
  // Create floating particles
  const container = document.querySelector('.particles');
  if(container){
    for(let i=0;i<25;i++){
      const span = document.createElement('span');
      span.className = 'particle';
      const size = Math.random()*8+4;
      span.style.width = size+'px';
      span.style.height = size+'px';
      span.style.left = Math.random()*100+'%';
      span.style.animationDuration = (Math.random()*10+8)+'s';
      span.style.animationDelay = (Math.random()*5)+'s';
      container.appendChild(span);
    }
  }
</script>

</body>
</html>
